<?xml version="1.0" standalone="no"?>

<kickstart>
	<description>
		Packages and configuration for the Nucleus proxy server.
	</description>

	<copyright>
	Copyright (c) 2000 - 2014 The Regents of the University of California.
	All rights reserved. Rocks(r) 6.2 www.rocksclusters.org

	</copyright>

    <package disable="1">httpd</package>
	<package>tomcat</package>
	<package>nucleus-guacamole-client</package>
    <package>httpd24u</package>
    <package>httpd24u-mod_ssl</package>
    <package>tomcat-connectors</package>

<post>

<!-- Enable Services -->
/sbin/chkconfig tomcat on
/sbin/chkconfig httpd on

/usr/sbin/groupadd -g8848 tomcat_comet
/usr/sbin/useradd -M -u513458 -g8848 -c "Comet tomcat" -d /usr/share/tomcat tomcat_comet
/usr/sbin/userdel tomcat

/bin/chown -R tomcat_comet:tomcat_comet /var/lib/tomcat
/bin/chown -R tomcat_comet:tomcat_comet /var/log/tomcat

/bin/sed -i -- 's/TOMCAT_USER="tomcat"/TOMCAT_USER="tomcat_comet"/' /etc/tomcat/tomcat.conf

<!-- Apache Configuration -->
<file name="/etc/httpd/conf.d/mod_jk.conf">
LoadModule jk_module modules/mod_jk.so
JkWorkersFile /etc/httpd/conf/workers.properties

# Where to put jk logs
JkLogFile     /var/log/httpd/mod_jk.log

# Set the jk log level [debug/error/info]
JkLogLevel    info

# Select the log format
JkLogStampFormat "[%a %b %d %H:%M:%S %Y] "

# JkOptions indicate to send SSL KEY SIZE,
JkOptions     +ForwardKeySize +ForwardURICompat -ForwardDirectories

# JkRequestLogFormat set the request format
JkRequestLogFormat     "%w %V %T"

JkMount /nucleus-guacamole-0.9.8/* ajp13

</file>

<!-- Post-install re-configuration for tomcat -->
<file name="/etc/rc.d/rocksconfig.d/post-98-tomcat-config.sh">
#!/bin/bash

# Tomcat rpm adds tomcat user and group which are NOT valid in
# Trestles trust domain. Fix that here...

/bin/rm /etc/rc.d/rocksconfig.d/post-98-tomcat-config.sh
</file>

<file name="/etc/httpd/conf/workers.properties">
workers.java_home=/usr/java/latest
ps=/
</file>

</post>

</kickstart>
